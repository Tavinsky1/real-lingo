{% load i18n %}
<!-- Slang Quiz Overlay -->
<div id="quizOverlay" class="quiz-overlay">
    <div id="quizContainer" class="quiz-container">
        <!-- Quiz content will be dynamically inserted here -->
    </div>
</div>

<!-- Quiz Element for Compatibility -->
<div class="slang-quiz-widget" id="slangQuiz" style="display: none;">
    <!-- Content will be generated by JavaScript -->
</div>

<style>
/* Quiz overlay styles - NO BLUR EFFECTS */
.quiz-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1999;
    display: none;
    justify-content: center;
    align-items: flex-start;
    padding: 20px;
    overflow-y: auto;
}

.quiz-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    width: 100%;
    max-width: 600px;
    margin-top: 20px;
    z-index: 2000;
    position: relative;
}

.quiz-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 12px 12px 0 0;
    text-align: center;
}

.quiz-body {
    padding: 30px;
}

.quiz-option {
    display: block;
    width: 100%;
    padding: 15px 20px;
    margin-bottom: 12px;
    background: #f8f9fa;
    border: 2px solid transparent;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 16px;
}

.quiz-option:hover {
    background: #e9ecef;
    border-color: #667eea;
    transform: translateX(5px);
}

.quiz-option.selected {
    background: #667eea;
    color: white;
    border-color: #5a6fd8;
}

.quiz-option.correct {
    background: #28a745;
    color: white;
    border-color: #1e7e34;
}

.quiz-option.incorrect {
    background: #dc3545;
    color: white;
    border-color: #bd2130;
}

.quiz-option.disabled {
    cursor: not-allowed;
    opacity: 0.6;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    margin: 15px 0;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea, #764ba2);
    transition: width 0.3s ease;
    border-radius: 4px;
}

.quiz-results {
    text-align: center;
    padding: 20px;
}

.score-display {
    font-size: 3rem;
    font-weight: bold;
    color: #28a745;
    margin: 20px 0;
}

.achievement {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(45deg, #FFD700, #FFA500);
    color: #333;
    border-radius: 25px;
    font-weight: bold;
    margin: 10px 5px;
    font-size: 18px;
}

.floating-text {
    position: absolute;
    font-weight: bold;
    font-size: 18px;
    pointer-events: none;
    z-index: 1000;
    animation: floatUp 2s ease-out forwards;
}

@keyframes floatUp {
    0% {
        opacity: 1;
        transform: translateY(0);
    }
    100% {
        opacity: 0;
        transform: translateY(-50px);
    }
}

@media (max-width: 768px) {
    .quiz-overlay {
        padding: 10px;
    }
    
    .quiz-container {
        margin-top: 10px;
    }
    
    .quiz-body {
        padding: 20px;
    }
    
    .quiz-option {
        padding: 12px 15px;
        font-size: 14px;
    }
}
</style>

<script>
// Get user language from session
const USER_LANGUAGE = '{{ request.session.user_language|default:"en" }}';

// Translation strings
const QUIZ_TRANSLATIONS = {
    {% if request.session.user_language == 'es' %}
        correct: 'Correcto! +1',
        incorrect: 'Incorrecto!',
        skipped: 'Saltado',
        quiz_complete: '¬°Quiz Completado!',
        slang_master: 'üèÜ ¬°Maestro del Slang!',
        good_job: '‚≠ê ¬°Buen Trabajo!',
        keep_learning: 'üìö ¬°Sigue Aprendiendo!',
        try_again: 'üí™ ¬°Int√©ntalo de Nuevo!',
        try_again_button: 'Intentar de Nuevo',
        close: 'Cerrar',
        percent_correct: '% Correcto',
        take_quiz: 'Tomar Quiz',
        argentine_slang_quiz: 'Quiz de Slang Argentino',
        australian_slang_quiz: 'Quiz de Slang Australiano',
        german_slang_quiz: 'Quiz de Slang Alem√°n',
        colombian_slang_quiz: 'Quiz de Slang Colombiano',
        belgian_slang_quiz: 'Quiz de Slang Belga'
    {% else %}
        correct: 'Correct! +1',
        incorrect: 'Incorrect!',
        skipped: 'Skipped',
        quiz_complete: 'Quiz Complete!',
        slang_master: 'üèÜ Slang Master!',
        good_job: '‚≠ê Good Job!',
        keep_learning: 'üìö Keep Learning!',
        try_again: 'üí™ Try Again!',
        try_again_button: 'Try Again',
        close: 'Close',
        percent_correct: '% Correct',
        take_quiz: 'Take Quiz',
        argentine_slang_quiz: 'Argentine Slang Quiz',
        australian_slang_quiz: 'Australian Slang Quiz',
        german_slang_quiz: 'German Slang Quiz',
        colombian_slang_quiz: 'Colombian Slang Quiz',
        belgian_slang_quiz: 'Belgian Slang Quiz'
    {% endif %}
};

class SlangQuiz {
    constructor() {
        this.currentQuestionIndex = 0;
        this.score = 0;
        this.selectedAnswer = null;
        this.currentCountry = this.detectCountry();
        this.questions = this.getCountryQuestions(this.currentCountry);
        this.init();
    }

    init() {
        // Create the quiz HTML structure
        this.createQuizHTML();
        return true;
    }

    createQuizHTML() {
        const container = document.getElementById('quizContainer');
        if (!container) return;

        container.innerHTML = `
            <div class="quiz-header">
                <h4 id="quizTitle">${this.getQuizTitle()}</h4>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <small>Question <span id="currentQuestion">1</span> of <span id="totalQuestions">${this.questions.length}</span> | Score: <span id="currentScore">0</span>/<span id="maxScore">${this.questions.length}</span></small>
            </div>
            <div class="quiz-body">
                <div id="quizContent">
                    <div class="quiz-question mb-4">
                        <h5 id="questionText">Loading question...</h5>
                    </div>
                    <div id="optionsContainer">
                        <!-- Options will be inserted here -->
                    </div>
                    <div class="quiz-controls mt-4 text-center">
                        <button class="btn btn-outline-secondary me-2" id="skipBtn" style="display: none;">
                            Skip
                        </button>
                        <button class="btn btn-primary" id="nextBtn" style="display: none;">
                            Next
                        </button>
                        <button class="btn btn-secondary" id="closeBtn">
                            ${QUIZ_TRANSLATIONS.close}
                        </button>
                    </div>
                </div>
            </div>
        `;

        // Attach event listeners
        this.attachEventListeners();
    }

    attachEventListeners() {
        document.getElementById('closeBtn').addEventListener('click', () => this.close());
        
        const nextBtn = document.getElementById('nextBtn');
        if (nextBtn) {
            nextBtn.addEventListener('click', () => this.nextQuestion());
        }
        
        const skipBtn = document.getElementById('skipBtn');
        if (skipBtn) {
            skipBtn.addEventListener('click', () => this.skipQuestion());
        }
    }

    detectCountry() {
        // Try to get country from URL path
        const path = window.location.pathname.toLowerCase();
        if (path.includes('/argentina/') || path.includes('/argentina')) return 'argentina';
        if (path.includes('/australia/') || path.includes('/australia')) return 'australia';
        if (path.includes('/germany/') || path.includes('/germany')) return 'germany';
        if (path.includes('/colombia/') || path.includes('/colombia')) return 'colombia';
        if (path.includes('/belgium/') || path.includes('/belgium')) return 'belgium';
        
        // Try to get from page context or data attributes
        const countryEl = document.querySelector('[data-country]');
        if (countryEl) return countryEl.dataset.country.toLowerCase();
        
        // Check for country flag or name in the page
        const pageContent = document.body.textContent.toLowerCase();
        if (pageContent.includes('argentina') || pageContent.includes('üá¶üá∑')) return 'argentina';
        if (pageContent.includes('australia') || pageContent.includes('üá¶üá∫')) return 'australia';
        if (pageContent.includes('germany') || pageContent.includes('üá©üá™')) return 'germany';
        if (pageContent.includes('colombia') || pageContent.includes('üá®üá¥')) return 'colombia';
        if (pageContent.includes('belgium') || pageContent.includes('üáßüá™')) return 'belgium';
        
        // Try to detect from page title
        const title = document.title.toLowerCase();
        if (title.includes('argentina')) return 'argentina';
        if (title.includes('australia')) return 'australia';
        if (title.includes('germany')) return 'germany';
        if (title.includes('colombia')) return 'colombia';
        if (title.includes('belgium')) return 'belgium';
        
        // Default to argentina if no country detected
        console.log('No country detected, defaulting to argentina');
        return 'argentina';
    }

    getCountryQuestions(country) {
        {% if request.session.user_language == 'es' %}
        const questionSets = {
            argentina: [
                {
                    term: "che",
                    question: `¬øQu√© significa 'che' en la jerga argentina?`,
                    options: ["Ey/che", "Dinero", "Casa", "Comida"],
                    correct: 0,
                    explanation: `'Che' es una interjecci√≥n com√∫n argentina que significa 'ey' o 'che'`
                },
                {
                    term: "boludo",
                    question: `¬øQu√© significa 'boludo'?`,
                    options: ["Persona inteligente", "Che/idiota", "Auto", "Fiesta"],
                    correct: 1,
                    explanation: `'Boludo' significa 'che' o puede ser 'idiota' dependiendo del contexto`
                },
                {
                    term: "pibe",
                    question: `¬øA qu√© se refiere 'pibe'?`,
                    options: ["Comida", "Persona joven", "Dinero", "M√∫sica"],
                    correct: 1,
                    explanation: `'Pibe' significa 'persona joven' o 'chico'`
                },
                {
                    term: "mate",
                    question: `¬øQu√© es 'mate' en Argentina?`,
                    options: ["Amigo", "Bebida tradicional", "Ambos", "Casa"],
                    correct: 2,
                    explanation: `'Mate' puede significar tanto 'amigo' como la bebida tradicional argentina`
                },
                {
                    term: "laburo",
                    question: `¬øQu√© significa 'laburo'?`,
                    options: ["Trabajo", "Fiesta", "Escuela", "Dormir"],
                    correct: 0,
                    explanation: `'Laburo' significa 'trabajo' o 'empleo'`
                }
            ],
            australia: [
                {
                    term: "arvo",
                    question: `¬øQu√© significa 'arvo' en la jerga australiana?`,
                    options: ["Ma√±ana", "Tarde", "Noche", "Medianoche"],
                    correct: 1,
                    explanation: `'Arvo' es la abreviaci√≥n de 'afternoon' (tarde) en jerga australiana`
                },
                {
                    term: "barbie",
                    question: `¬øQu√© es una 'barbie' en Australia?`,
                    options: ["Mu√±eca", "Parrillada", "Bar", "Playa"],
                    correct: 1,
                    explanation: `'Barbie' es jerga australiana para parrillada`
                },
                {
                    term: "bogan",
                    question: `¬øQu√© es un 'bogan'?`,
                    options: ["Persona rica", "Persona de clase trabajadora", "Turista", "Maestro"],
                    correct: 1,
                    explanation: `'Bogan' se refiere a un australiano de clase trabajadora, a menudo con rasgos culturales espec√≠ficos`
                },
                {
                    term: "fair dinkum",
                    question: `¬øQu√© significa 'fair dinkum'?`,
                    options: ["Caro", "Genuino/verdadero", "Divertido", "Dif√≠cil"],
                    correct: 1,
                    explanation: `'Fair dinkum' significa genuino, verdadero u honesto`
                },
                {
                    term: "sheila",
                    question: `¬øQu√© es una 'sheila'?`,
                    options: ["Casa", "Mujer", "Auto", "Perro"],
                    correct: 1,
                    explanation: `'Sheila' es jerga australiana para mujer`
                }
            ],
            germany: [
                {
                    term: "geil",
                    question: `¬øQu√© significa 'geil' en la jerga alemana moderna?`,
                    options: ["Terrible", "Genial/cool", "Caro", "Dif√≠cil"],
                    correct: 1,
                    explanation: `'Geil' en jerga moderna significa 'genial' o 'cool'`
                },
                {
                    term: "krass",
                    question: `¬øQu√© expresa 'krass'?`,
                    options: ["Aburrido", "Extremo/intenso", "Silencioso", "Simple"],
                    correct: 1,
                    explanation: `'Krass' significa 'extremo', 'intenso' o 'loco'`
                },
                {
                    term: "digga",
                    question: `¬øQu√© significa 'digga'?`,
                    options: ["Pala", "Che/amigo", "Dinero", "Comida"],
                    correct: 1,
                    explanation: `'Digga' es jerga para 'che' o 'amigo'`
                },
                {
                    term: "bock haben",
                    question: `¬øQu√© significa 'Bock haben'?`,
                    options: ["Estar cansado", "Querer/tener ganas de hacer", "Estar enojado", "Tener hambre"],
                    correct: 1,
                    explanation: `'Bock haben' significa 'querer' o 'tener ganas de hacer algo'`
                },
                {
                    term: "feierabend",
                    question: `¬øQu√© es 'Feierabend'?`,
                    options: ["Ma√±ana", "Fin del d√≠a laboral", "Fin de semana", "Feriado"],
                    correct: 1,
                    explanation: `'Feierabend' se refiere al final del d√≠a laboral`
                }
            ],
            colombia: [
                {
                    term: "parcero",
                    question: `¬øQu√© significa 'parcero' en la jerga colombiana?`,
                    options: ["Amigo/parcero", "Dinero", "Casa", "Comida"],
                    correct: 0,
                    explanation: `'Parcero' significa 'amigo' o 'parcero' en jerga colombiana`
                },
                {
                    term: "chimba",
                    question: `¬øQu√© expresa 'chimba'?`,
                    options: ["Malo", "Genial/bacano", "Caro", "Dif√≠cil"],
                    correct: 1,
                    explanation: `'Chimba' significa 'genial' o 'bacano' en jerga colombiana`
                },
                {
                    term: "bacano",
                    question: `¬øQu√© significa 'bacano'?`,
                    options: ["Terrible", "Genial/bueno", "Caro", "Cansado"],
                    correct: 1,
                    explanation: `'Bacano' significa 'genial' o 'bueno' en espa√±ol colombiano`
                },
                {
                    term: "man",
                    question: `¬øC√≥mo se usa 'man' en la jerga colombiana?`,
                    options: ["Solo para hombres", "Amigo/che (cualquier g√©nero)", "Jefe", "Extra√±o"],
                    correct: 1,
                    explanation: `'Man' se usa como 'amigo' o 'che' para cualquier g√©nero en jerga colombiana`
                },
                {
                    term: "tinto",
                    question: `¬øQu√© es 'tinto' en Colombia?`,
                    options: ["Vino", "Caf√© negro", "T√©", "Gaseosa"],
                    correct: 1,
                    explanation: `'Tinto' se refiere al caf√© negro en espa√±ol colombiano`
                }
            ],
            belgium: [
                {
                    term: "allee",
                    question: `¬øQu√© significa 'allee' en la jerga belga?`,
                    options: ["¬°Vamos! / ¬°Dale!", "Adi√≥s", "Hola", "Gracias"],
                    correct: 0,
                    explanation: `'Allee' viene del franc√©s 'Allez' y significa '¬°Vamos!' o '¬°Dale!'`
                },
                {
                    term: "goesting",
                    question: `¬øQu√© expresa 'goesting'?`,
                    options: ["Enojo", "Un deseo/antojo profundo", "Tristeza", "Confusi√≥n"],
                    correct: 1,
                    explanation: `'Goesting' significa un antojo o deseo visceral profundo - una palabra t√≠picamente flamenca`
                },
                {
                    term: "ambetant",
                    question: `¬øQu√© significa 'ambetant'?`,
                    options: ["Incre√≠ble", "Molesto", "Caro", "Divertido"],
                    correct: 1,
                    explanation: `'Ambetant' significa molesto, tomado del franc√©s 'emb√™tant'`
                },
                {
                    term: "zwanze",
                    question: `¬øQu√© es 'zwanze' en la cultura belga?`,
                    options: ["Un baile", "Un tipo de humor", "Una comida", "Una canci√≥n"],
                    correct: 1,
                    explanation: `'Zwanze' es el humor popular caracter√≠stico de Bruselas con sarcasmo y autoburla`
                },
                {
                    term: "kot",
                    question: `¬øQu√© es un 'kot' en B√©lgica?`,
                    options: ["Un gato", "Habitaci√≥n de estudiante", "Bicicleta", "Restaurante"],
                    correct: 1,
                    explanation: `'Kot' es un t√©rmino belga para habitaci√≥n de estudiante o apartamento peque√±o`
                }
            ]
        };
        {% else %}
        const questionSets = {
            argentina: [
                {
                    term: "che",
                    question: "What does 'che' mean in Argentine slang?",
                    options: ["Hey/dude", "Money", "House", "Food"],
                    correct: 0,
                    explanation: "'Che' is a common Argentine interjection meaning 'hey' or 'dude'"
                },
                {
                    term: "boludo",
                    question: "What does 'boludo' mean?",
                    options: ["Smart person", "Dude/idiot", "Car", "Party"],
                    correct: 1,
                    explanation: "'Boludo' means 'dude' or can be 'idiot' depending on context"
                },
                {
                    term: "pibe",
                    question: "What does 'pibe' refer to?",
                    options: ["Food", "Young person", "Money", "Music"],
                    correct: 1,
                    explanation: "'Pibe' means 'young person' or 'kid'"
                },
                {
                    term: "mate",
                    question: "What is 'mate' in Argentina?",
                    options: ["Friend", "Traditional drink", "Both", "House"],
                    correct: 2,
                    explanation: "'Mate' can mean both 'friend' and the traditional Argentine tea drink"
                },
                {
                    term: "laburo",
                    question: "What does 'laburo' mean?",
                    options: ["Work/job", "Party", "School", "Sleep"],
                    correct: 0,
                    explanation: "'Laburo' means 'work' or 'job'"
                }
            ],
            australia: [
                {
                    term: "arvo",
                    question: "What does 'arvo' mean in Australian slang?",
                    options: ["Morning", "Afternoon", "Evening", "Night"],
                    correct: 1,
                    explanation: "'Arvo' is short for 'afternoon' in Australian slang"
                },
                {
                    term: "barbie",
                    question: "What is a 'barbie' in Australia?",
                    options: ["Doll", "Barbecue", "Bar", "Beach"],
                    correct: 1,
                    explanation: "'Barbie' is Australian slang for barbecue"
                },
                {
                    term: "bogan",
                    question: "What is a 'bogan'?",
                    options: ["Rich person", "Working-class person", "Tourist", "Teacher"],
                    correct: 1,
                    explanation: "'Bogan' refers to a working-class Australian, often with specific cultural traits"
                },
                {
                    term: "fair dinkum",
                    question: "What does 'fair dinkum' mean?",
                    options: ["Expensive", "Genuine/true", "Funny", "Difficult"],
                    correct: 1,
                    explanation: "'Fair dinkum' means genuine, true, or honest"
                },
                {
                    term: "sheila",
                    question: "What is a 'sheila'?",
                    options: ["House", "Woman", "Car", "Dog"],
                    correct: 1,
                    explanation: "'Sheila' is Australian slang for a woman"
                }
            ],
            germany: [
                {
                    term: "geil",
                    question: "What does 'geil' mean in modern German slang?",
                    options: ["Terrible", "Awesome/cool", "Expensive", "Difficult"],
                    correct: 1,
                    explanation: "'Geil' in modern slang means 'awesome' or 'cool'"
                },
                {
                    term: "krass",
                    question: "What does 'krass' express?",
                    options: ["Boring", "Extreme/intense", "Quiet", "Simple"],
                    correct: 1,
                    explanation: "'Krass' means 'extreme', 'intense', or 'crazy'"
                },
                {
                    term: "digga",
                    question: "What does 'digga' mean?",
                    options: ["Shovel", "Dude/buddy", "Money", "Food"],
                    correct: 1,
                    explanation: "'Digga' is slang for 'dude' or 'buddy'"
                },
                {
                    term: "bock haben",
                    question: "What does 'Bock haben' mean?",
                    options: ["To be tired", "To want/feel like doing", "To be angry", "To be hungry"],
                    correct: 1,
                    explanation: "'Bock haben' means 'to want to' or 'to feel like doing something'"
                },
                {
                    term: "feierabend",
                    question: "What is 'Feierabend'?",
                    options: ["Morning", "End of work day", "Weekend", "Holiday"],
                    correct: 1,
                    explanation: "'Feierabend' refers to the end of the work day"
                }
            ],
            colombia: [
                {
                    term: "parcero",
                    question: "What does 'parcero' mean in Colombian slang?",
                    options: ["Friend/buddy", "Money", "House", "Food"],
                    correct: 0,
                    explanation: "'Parcero' means 'friend' or 'buddy' in Colombian slang"
                },
                {
                    term: "chimba",
                    question: "What does 'chimba' express?",
                    options: ["Bad", "Cool/awesome", "Expensive", "Difficult"],
                    correct: 1,
                    explanation: "'Chimba' means 'cool' or 'awesome' in Colombian slang"
                },
                {
                    term: "bacano",
                    question: "What does 'bacano' mean?",
                    options: ["Terrible", "Cool/nice", "Expensive", "Tired"],
                    correct: 1,
                    explanation: "'Bacano' means 'cool' or 'nice' in Colombian Spanish"
                },
                {
                    term: "man",
                    question: "How is 'man' used in Colombian slang?",
                    options: ["Only for males", "Friend/dude (any gender)", "Boss", "Stranger"],
                    correct: 1,
                    explanation: "'Man' is used as 'friend' or 'dude' for any gender in Colombian slang"
                },
                {
                    term: "tinto",
                    question: "What is 'tinto' in Colombia?",
                    options: ["Wine", "Black coffee", "Tea", "Soda"],
                    correct: 1,
                    explanation: "'Tinto' refers to black coffee in Colombian Spanish"
                }
            ],
            belgium: [
                {
                    term: "allee",
                    question: "What does 'allee' mean in Belgian slang?",
                    options: ["Come on! / Let's go!", "Goodbye", "Hello", "Thank you"],
                    correct: 0,
                    explanation: "'Allee' is borrowed from French 'Allez' and means 'Come on!' or 'Let's go!'"
                },
                {
                    term: "goesting",
                    question: "What does 'goesting' express?",
                    options: ["Anger", "A deep desire/craving", "Sadness", "Confusion"],
                    correct: 1,
                    explanation: "'Goesting' means a deep, visceral craving or desire - a quintessential Flemish word"
                },
                {
                    term: "ambetant",
                    question: "What does 'ambetant' mean?",
                    options: ["Amazing", "Annoying", "Expensive", "Funny"],
                    correct: 1,
                    explanation: "'Ambetant' means annoying, borrowed from French 'emb√™tant'"
                },
                {
                    term: "zwanze",
                    question: "What is 'zwanze' in Belgian culture?",
                    options: ["A dance", "A type of humor", "A food", "A song"],
                    correct: 1,
                    explanation: "'Zwanze' is Brussels' characteristic folk humor featuring sarcasm and self-mockery"
                },
                {
                    term: "kot",
                    question: "What is a 'kot' in Belgium?",
                    options: ["A cat", "Student room", "Bicycle", "Restaurant"],
                    correct: 1,
                    explanation: "'Kot' is a pan-Belgian term for a student room or small apartment"
                }
            ]
        };
        {% endif %}

        return questionSets[country] || questionSets.argentina;
    }

    getQuizTitle() {
        const quizTitleMap = {
            'argentina': QUIZ_TRANSLATIONS.argentine_slang_quiz,
            'australia': QUIZ_TRANSLATIONS.australian_slang_quiz,
            'germany': QUIZ_TRANSLATIONS.german_slang_quiz,
            'colombia': QUIZ_TRANSLATIONS.colombian_slang_quiz,
            'belgium': QUIZ_TRANSLATIONS.belgian_slang_quiz
        };
        
        return quizTitleMap[this.currentCountry] || QUIZ_TRANSLATIONS.argentine_slang_quiz;
    }

    showQuestion() {
        const question = this.questions[this.currentQuestionIndex];
        if (!question) return;

        // Update question counter
        const currentQuestionEl = document.getElementById('currentQuestion');
        if (currentQuestionEl) {
            currentQuestionEl.textContent = this.currentQuestionIndex + 1;
        }
        
        // Update progress bar
        const progressFill = document.getElementById('progressFill');
        if (progressFill) {
            const progress = ((this.currentQuestionIndex) / this.questions.length) * 100;
            progressFill.style.width = progress + '%';
        }
        
        // Update question text
        const questionTextEl = document.getElementById('questionText');
        if (questionTextEl) {
            questionTextEl.textContent = question.question;
        }
        
        // Create options
        const optionsContainer = document.getElementById('optionsContainer');
        if (optionsContainer) {
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'quiz-option';
                optionButton.textContent = option;
                optionButton.dataset.index = index;
                optionButton.addEventListener('click', () => this.selectAnswer(index));
                optionsContainer.appendChild(optionButton);
            });
        }

        // Reset controls
        const nextBtn = document.getElementById('nextBtn');
        const skipBtn = document.getElementById('skipBtn');
        if (nextBtn) nextBtn.style.display = 'none';
        if (skipBtn) skipBtn.style.display = 'inline-block';
        
        this.selectedAnswer = null;
    }

    selectAnswer(answerIndex) {
        if (this.selectedAnswer !== null) return; // Already answered

        this.selectedAnswer = answerIndex;
        const question = this.questions[this.currentQuestionIndex];
        const options = document.querySelectorAll('.quiz-option');
        
        // Disable all options
        options.forEach(option => option.classList.add('disabled'));
        
        // Show correct/incorrect
        options.forEach((option, index) => {
            if (index === question.correct) {
                option.classList.add('correct');
            } else if (index === answerIndex && index !== question.correct) {
                option.classList.add('incorrect');
            }
        });

        // Update score
        if (answerIndex === question.correct) {
            this.score++;
            document.getElementById('currentScore').textContent = this.score;
            this.showFloatingText(QUIZ_TRANSLATIONS.correct, 'success');
        } else {
            this.showFloatingText(QUIZ_TRANSLATIONS.incorrect, 'error');
        }

        // Show explanation
        setTimeout(() => {
            this.showExplanation(question.explanation);
        }, 1000);

        // Show next button
        document.getElementById('skipBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'inline-block';
    }

    showExplanation(explanation) {
        const explanationDiv = document.createElement('div');
        explanationDiv.className = 'quiz-explanation mt-3 p-3 bg-light rounded';
        explanationDiv.style.cssText = 'margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #667eea;';
        explanationDiv.innerHTML = `<small class="text-muted"><i class="bi bi-info-circle me-1"></i>${explanation}</small>`;
        document.getElementById('quizContent').appendChild(explanationDiv);
    }

    nextQuestion() {
        this.currentQuestionIndex++;
        
        if (this.currentQuestionIndex >= this.questions.length) {
            this.showResults();
        } else {
            // Remove explanation
            const explanation = document.querySelector('.quiz-explanation');
            if (explanation) explanation.remove();
            
            this.showQuestion();
        }
    }

    skipQuestion() {
        // Mark as skipped and move to next
        this.selectedAnswer = -1; // Special value for skipped
        this.showFloatingText(QUIZ_TRANSLATIONS.skipped, 'warning');
        
        setTimeout(() => {
            this.nextQuestion();
        }, 500);
    }

    showResults() {
        const percentage = Math.round((this.score / this.questions.length) * 100);
        let achievement = '';
        
        if (percentage >= 80) {
            achievement = QUIZ_TRANSLATIONS.slang_master;
        } else if (percentage >= 60) {
            achievement = QUIZ_TRANSLATIONS.good_job;
        } else if (percentage >= 40) {
            achievement = QUIZ_TRANSLATIONS.keep_learning;
        } else {
            achievement = QUIZ_TRANSLATIONS.try_again;
        }

        document.getElementById('quizContent').innerHTML = `
            <div class="quiz-results">
                <h3>${QUIZ_TRANSLATIONS.quiz_complete}</h3>
                <div class="score-display">${this.score}/${this.questions.length}</div>
                <div class="mb-3">${percentage}${QUIZ_TRANSLATIONS.percent_correct}</div>
                <div class="achievement">${achievement}</div>
                <div class="mt-4">
                    <button class="btn btn-primary me-2" onclick="window.slangQuiz.restart()">
                        <i class="bi bi-arrow-clockwise me-1"></i>${QUIZ_TRANSLATIONS.try_again_button}
                    </button>
                    <button class="btn btn-outline-secondary" onclick="window.slangQuiz.close()">
                        <i class="bi bi-x-lg me-1"></i>${QUIZ_TRANSLATIONS.close}
                    </button>
                </div>
            </div>
        `;

        // Hide controls
        const controls = document.querySelector('.quiz-controls');
        if (controls) controls.style.display = 'none';
    }

    showFloatingText(text, type) {
        const floatingText = document.createElement('div');
        floatingText.className = `floating-text text-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'warning'}`;
        floatingText.textContent = text;
        floatingText.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 1.2rem;
            pointer-events: none;
            z-index: 3000;
        `;
        
        document.body.appendChild(floatingText);
        
        floatingText.animate([
            { opacity: 1, transform: 'translate(-50%, -50%)' },
            { opacity: 0, transform: 'translate(-50%, -80px)' }
        ], {
            duration: 1500,
            easing: 'ease-out'
        }).onfinish = () => floatingText.remove();
    }

    restart() {
        this.currentQuestionIndex = 0;
        this.score = 0;
        this.selectedAnswer = null;
        
        // Reset score display
        document.getElementById('currentScore').textContent = '0';
        
        // Show controls
        const controls = document.querySelector('.quiz-controls');
        if (controls) controls.style.display = 'block';
        
        // Reset content
        this.showQuestion();
    }

    show() {
        console.log('Showing quiz...');
        
        // Scroll to top for better visibility
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // Show quiz overlay
        const overlay = document.getElementById('quizOverlay');
        if (overlay) {
            overlay.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent body scroll
            
            // Load first question
            this.showQuestion();
        }
        
        console.log('‚úÖ Quiz shown successfully');
    }

    close() {
        console.log('Closing quiz...');
        
        // Hide quiz overlay
        const overlay = document.getElementById('quizOverlay');
        if (overlay) {
            overlay.style.display = 'none';
            document.body.style.overflow = ''; // Restore body scroll
        }
        
        console.log('‚úÖ Quiz closed');
    }
}

// Initialize quiz when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM loaded, initializing quiz...');
    
    try {
        // Create quiz instance
        const quizInstance = new SlangQuiz();
        window.slangQuiz = quizInstance;
        console.log('‚úÖ Quiz instance created and assigned to window.slangQuiz');
    } catch (error) {
        console.error('‚ùå Error creating quiz instance:', error);
    }
    
    // Add quiz trigger button
    const quizTrigger = document.createElement('button');
    quizTrigger.className = 'btn btn-info btn-sm quiz-trigger';
    quizTrigger.innerHTML = `<i class="bi bi-question-circle me-1"></i>${QUIZ_TRANSLATIONS.take_quiz}`;
    quizTrigger.style.cssText = `
        position: fixed;
        bottom: 140px;
        right: 20px;
        z-index: 1000;
        border-radius: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        background-color: #17a2b8 !important;
        border-color: #17a2b8 !important;
        color: white !important;
        padding: 10px 15px;
        font-weight: 500;
    `;
    
    quizTrigger.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('üéØ Quiz trigger clicked!');
        
        if (window.slangQuiz && typeof window.slangQuiz.show === 'function') {
            window.slangQuiz.show();
        } else {
            console.error('‚ùå Quiz instance not available');
            // Try to create a new instance
            try {
                window.slangQuiz = new SlangQuiz();
                window.slangQuiz.show();
            } catch (error) {
                console.error('‚ùå Failed to create quiz instance:', error);
                alert('Quiz system is unavailable. Please refresh the page and try again.');
            }
        }
    });
    
    document.body.appendChild(quizTrigger);
    console.log('‚úÖ Quiz trigger button added');
});
</script>
